#encoding:utf-8
'''
用户实例化
'''
from django.db import transaction 
from rest_framework import serializers
from user.models import *

class CarSerializers(serializers.ModelSerializer):
    '''
    客户汽车序列化
    '''

    class Meta:
        model  = Car
        fields = '__all__'

class PaymentInfoSerializers(serializers.ModelSerializer):
    '''
    收款信息序列化
    '''
    created_at = serializers.DateTimeField(format='%Y-%m-%d %H:%M:%S')
    updated_at = serializers.DateTimeField(format='%Y-%m-%d %H:%M:%S')

    class Meta:
        model  = PaymentInfo
        fields = '__all__'

class CustomerSerializers(serializers.ModelSerializer):
    '''
    客户信息序列化
    '''   

    class Meta:
        model  = Customer
        fields = '__all__'

class CustomerDetailInfoSerializers(serializers.ModelSerializer):
    '''
    客户信息序列化
    '''
    defaultPayInfo = serializers.SerializerMethodField()
    def get_defaultPayInfo(self, obj):
        '''
        获取默认收款信息
        '''
        try:
            defaultPayInfo = obj.payinfo_customer.get(is_default=True)
            return PaymentInfoSerializers(defaultPayInfo).data
        except Exception as e:#PaymentInfo.DoesNotExist:
            #raise e
            return dict()

    cars = serializers.SerializerMethodField()
    def get_cars(self, obj):
        '''
        获取客户的汽车信息
        '''
        cars = obj.car_set.all()
        return CarSerializers(cars, many=True).data

    childs = serializers.SerializerMethodField()
    def get_childs(self, obj):
        childs = obj.customer_set.all()
        return CustomerSerializers(childs, many=True).data

    class Meta:
        model  = Customer
        fields = '__all__'