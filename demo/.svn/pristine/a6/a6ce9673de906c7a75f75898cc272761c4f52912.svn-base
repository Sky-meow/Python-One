#encoding:utf-8
#coding=utf-8

from rest_framework import permissions
from rest_framework.authentication import BaseAuthentication
from api.models import customer_auth
from api.response import JsonResponse
from rest_framework import HTTP_HEADER_ENCODING, exceptions
from django.core.cache import cache
import datetime

def checkToken(func):
    def wrapper(request, *args, **kwargs):
        if 'token' not in kwargs.keys():
            return JsonResponse(code=403,desc=u'请先登陆')
        else:
            try:
                token = customer_auth.objects.get(token=kwargs['token'])
                if not token.checkToken():
                    return JsonResponse(code=403,desc=u'Token已过期')
                else:
                    request.user = token.customer
            except customer_auth.DoesNotExist:
                return JsonResponse(code=403,desc=u'Token信息不正确')
        return func(request,*args, **kwargs)
    return wrapper