#encoding:utf-8

import xadmin
from xadmin import views
from .models import *

'''
账款后台功能
'''

class CreditAdmin(object):
    '''
    记账单管理
    '''
    list_display = ['buessini', 'order', 'amt', 'is_paid', 'created_at', 'receipt', 'closed_at']
    search_fields = ['buessini', 'order', 'receipt']
    list_filter = []
    #readonly_fields = ['buessini', 'order', 'amt', 'is_paid', 'receipt', 'closed_at']

    def get(self, request, *args, **kwargs):
        response = super(CreditAdmin, self).get(request, *args, **kwargs)
        print(response.context_data.keys())
        if 'add' in response.context_data.keys():
            if response.context_data['add']:
                '''
                如果是新增状态下,没有只读字段
                '''
                self.readonly_fields = ()
                self.prepare_form()
                self.instance_forms()
                self.setup_forms()
                response = self.get_response()

        return response

    def save_models(self):
        if self.org_obj is None:
            self.new_obj.created_by = self.request.user
            self.new_obj.save()
        else:
            self.new_obj.updated_by = self.request.user
            self.new_obj.save()

xadmin.site.register(Credit,CreditAdmin)